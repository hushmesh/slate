
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Hushmesh API Documentation</title>
    <link href="images/favicon.ico" rel="icon" type="image/ico" />

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/header-3554a804.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/screen-6fdd040c.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-b95b5c21.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-cb13295e.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700&display=swap" rel="stylesheet">
  </head>

  <body class="index" data-languages="[]">

     <header class="site-header" id="site-header">
      <a href="/" class="site-logo">
        <img src="images/logo-692d5d49.svg" alt="Logo" />
      </a>
      <nav class="site-nav index">
        <div class="nav-portal">
          <a href="https://developer.hushmesh.com" class="nav-active">Documentation</a>
          <a href="https://developer.hushmesh.com/relying-party-registration">Manage Apps</a>
          <a href="https://developer.hushmesh.com/token-viewer">View Token Structure</a>
        </div>
        <aside class="nav-external">
          <a href="https://www.npmjs.com/package/@hushmesh/meshlib" target="_blank" class="link-external">meshlib Library</a>
          <a href="https://www.hushmesh.com" target="_blank" class="link-external">Hushmesh.com</a>
        </aside>
        <button class="site-nav-toggle" id="site-nav-toggle" title="Show site navigation"><span></span></button>
      </nav>
    </header>

    <button id="nav-button" title="Show and search table of contents">
      <span>
        Search
      </span>
    </button>

    <div class="toc-wrapper">
        <div class="search">
          <input type="search" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#what-is-the-nbsp-mesh" class="toc-h2 toc-link" data-title="What is the Mesh?">What is the Mesh?</a>
                  </li>
                  <li>
                    <a href="#what-you-can-do-as-nbsp-a-nbsp-developer" class="toc-h2 toc-link" data-title="What you can do as a developer?">What you can do as a developer?</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#mesh-nbsp-in" class="toc-h1 toc-link" data-title="Mesh in">Mesh in</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#mesh-nbsp-in-button" class="toc-h2 toc-link" data-title="Mesh in button">Mesh in button</a>
                  </li>
                  <li>
                    <a href="#how-to-nbsp-generate-code-challenge-and-code-verifier" class="toc-h2 toc-link" data-title="How to generate code challenge and code verifier">How to generate code challenge and code verifier</a>
                  </li>
                  <li>
                    <a href="#exchange-code-to-nbsp-oauth-nbsp-tokens" class="toc-h2 toc-link" data-title="Exchange code to OAuth tokens">Exchange code to OAuth tokens</a>
                  </li>
                  <li>
                    <a href="#mesh-nbsp-in-example-for-a-nbsp-simple-html-js-nbsp-page" class="toc-h2 toc-link" data-title="Mesh in example for a simple HTML/JS page">Mesh in example for a simple HTML/JS page</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#oauth-tokens" class="toc-h1 toc-link" data-title="OAuth tokens">OAuth tokens</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#object-fields" class="toc-h2 toc-link" data-title="Object fields">Object fields</a>
                  </li>
                  <li>
                    <a href="#parsing-masterkey" class="toc-h2 toc-link" data-title="Parsing masterKey">Parsing masterKey</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#application-example" class="toc-h1 toc-link" data-title="Application example">Application example</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#application-stack" class="toc-h2 toc-link" data-title="Application stack">Application stack</a>
                  </li>
                  <li>
                    <a href="#app-registration" class="toc-h2 toc-link" data-title="App registration">App registration</a>
                  </li>
                  <li>
                    <a href="#mesh-in-button" class="toc-h2 toc-link" data-title="Mesh in button">Mesh in button</a>
                  </li>
                  <li>
                    <a href="#callback-page" class="toc-h2 toc-link" data-title="Callback page">Callback page</a>
                  </li>
                  <li>
                    <a href="#auth-page" class="toc-h2 toc-link" data-title="Auth page">Auth page</a>
                  </li>
                  <li>
                    <a href="#getting-user-39-s-info" class="toc-h2 toc-link" data-title="Getting user's info">Getting user's info</a>
                  </li>
                  <li>
                    <a href="#encryption" class="toc-h2 toc-link" data-title="Encryption">Encryption</a>
                  </li>
                  <li>
                    <a href="#fetch-and-store-data" class="toc-h2 toc-link" data-title="Fetch and store data">Fetch and store data</a>
                  </li>
                  <li>
                    <a href="#save-data" class="toc-h2 toc-link" data-title="Save data">Save data</a>
                  </li>
                  <li>
                    <a href="#fetch-and-delete-nbsp-data" class="toc-h2 toc-link" data-title="Fetch and delete data">Fetch and delete data</a>
                  </li>
                  <li>
                    <a href="#object-nbsp-ids-available-to-nbsp-a-nbsp-user" class="toc-h2 toc-link" data-title="Object IDs available to a user">Object IDs available to a user</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#storage-api" class="toc-h1 toc-link" data-title="Storage API">Storage API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-object-ids" class="toc-h2 toc-link" data-title="Get object IDs">Get object IDs</a>
                  </li>
                  <li>
                    <a href="#store-data" class="toc-h2 toc-link" data-title="Store data">Store data</a>
                  </li>
                  <li>
                    <a href="#get-stored-data" class="toc-h2 toc-link" data-title="Get stored data">Get stored data</a>
                  </li>
                  <li>
                    <a href="#delete-stored-data" class="toc-h2 toc-link" data-title="Delete stored data">Delete stored data</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#user-info" class="toc-h1 toc-link" data-title="User info">User info</a>
          </li>
          <li>
            <a href="#mesh-out" class="toc-h1 toc-link" data-title="Mesh out">Mesh out</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#header-example" class="toc-h2 toc-link" data-title="Header example">Header example</a>
                  </li>
                  <li>
                    <a href="#meshlib" class="toc-h2 toc-link" data-title="Meshlib">Meshlib</a>
                  </li>
                  <li>
                    <a href="#meshout-api" class="toc-h2 toc-link" data-title="Meshout API">Meshout API</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#browser-extension" class="toc-h1 toc-link" data-title="Browser extension">Browser extension</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#identity-api" class="toc-h2 toc-link" data-title="Identity API">Identity API</a>
                  </li>
                  <li>
                    <a href="#caveats" class="toc-h2 toc-link" data-title="Caveats">Caveats</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>This is&nbsp;the official documentation of&nbsp;the Hushmesh API.</p>
<h2 id='what-is-the-nbsp-mesh'>What is the&nbsp;Mesh?</h2>
<p>The mesh is&nbsp;the &quot;trust network&quot;. Much like social networks, the mesh enables digital interactions between people and organizations. But unlike traditional social networks, the mesh does not target a&nbsp;specific application or&nbsp;mode of&nbsp;communication. Rather, it&nbsp;is&nbsp;designed from the ground up&nbsp;as&nbsp;a&nbsp;neutral platform to&nbsp;enable digital trust and privacy as&nbsp;a&nbsp;service to&nbsp;all other applications, websites, services and devices, for everyone and every organization.</p>
<h2 id='what-you-can-do-as-nbsp-a-nbsp-developer'>What you can do as&nbsp;a&nbsp;developer?</h2>
<p>You can create applications in&nbsp;the portal and use the mesh for your usecases.</p>
<h1 id='mesh-nbsp-in'>Mesh&nbsp;in</h1>
<p>In&nbsp;order to&nbsp;make authorized calls to&nbsp;the Mesh, you must first obtain an&nbsp;access token. This section describes how to&nbsp;obtain such a&nbsp;token.</p>

<p>Before getting started, you need&nbsp;to <a href="http://developer.hushmesh.com/relying-party-registration">create an&nbsp;app</a> and configure a&nbsp;valid redirect URL. A&nbsp;registered HushMesh integration is&nbsp;assigned a&nbsp;unique Client ID&nbsp;and Client Secret which are needed for the OAuth2&nbsp;flow.</p>

<p>Recommended way to&nbsp;autorize user to&nbsp;the mesh as&nbsp;a&nbsp;developer is&nbsp;by&nbsp;using our npm <a href="https://www.npmjs.com/package/@hushmesh/meshlib">meshlib</a> library.</p>
<h2 id='mesh-nbsp-in-button'>Mesh&nbsp;in button</h2>
<blockquote>
<p>Include an init:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Auth</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@hushmesh/meshlib'</span>

<span class="kr">const</span> <span class="nx">meshApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Auth</span><span class="p">({</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="s1">'YOUR_CLIENT_ID'</span><span class="p">,</span>
  <span class="na">responseType</span><span class="p">:</span> <span class="s1">'code'</span><span class="p">,</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="s1">'https://beta.hushsafe.com/auth'</span><span class="p">,</span>
  <span class="nx">codeChallenge</span><span class="p">,</span>
  <span class="na">codeChallengeMethod</span><span class="p">:</span> <span class="s1">'S256'</span><span class="p">,</span>
  <span class="na">isPopup</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">})</span>
</code></pre>
<p>If&nbsp;you are using any modern JavaScript framework, you can create mesh in&nbsp;button component and inside the component include and initialize mesh in&nbsp;library. You can <a href="https://www.npmjs.com/package/@hushmesh/meshlib">install meshlib</a> from npm and include it&nbsp;in&nbsp;your project.</p>

<blockquote>
<p>Inside handler:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">meshApi</span><span class="p">.</span><span class="nx">meshin</span><span class="p">()</span>
</code></pre>
<p>After that you just need to&nbsp;use mesh in&nbsp;method inside your <code>onClick</code> handler.</p>

<p>After successful mesh in&nbsp;you&rsquo;re going to&nbsp;be&nbsp;redirected to&nbsp;the page, specified in&nbsp;the <code>redirectUri</code>.</p>
<h2 id='how-to-nbsp-generate-code-challenge-and-code-verifier'>How to&nbsp;generate code challenge and code verifier</h2>
<blockquote>
<p>Generate challenge data example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">CryptoJS</span> <span class="nx">from</span> <span class="s1">'crypto-js'</span>

<span class="kr">const</span> <span class="nx">generateChallengeData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">codeVerifier</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">lib</span><span class="p">.</span><span class="nx">WordArray</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">128</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Base64</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">codeChallenge</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Base64</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">sha256</span><span class="p">(</span><span class="nx">codeVerifier</span><span class="p">)).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/=/g</span><span class="p">,</span> <span class="s1">''</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\+</span><span class="sr">/g</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\/</span><span class="sr">/g</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">{</span> <span class="nx">codeVerifier</span><span class="p">,</span> <span class="nx">codeChallenge</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>In&nbsp;order to&nbsp;get user tokens first you have to&nbsp;obtain the authorization code. Next you can exchange your authorization code and code verifier for tokens.</p>
<h2 id='exchange-code-to-nbsp-oauth-nbsp-tokens'>Exchange code to&nbsp;OAuth&nbsp;tokens</h2>
<blockquote>
<p>Token service example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">'axios'</span>

<span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/getToken'</span>
<span class="kr">const</span> <span class="nx">CLIENT_ID</span> <span class="o">=</span> <span class="s1">'YOUR_CLIENT_ID'</span>
<span class="kr">const</span> <span class="nx">REDIRECT_URI</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span>

<span class="kr">const</span> <span class="nx">getTokens</span> <span class="o">=</span> <span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">payload</span>

  <span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">()</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'client_id'</span><span class="p">,</span> <span class="nx">CLIENT_ID</span><span class="p">)</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'code_verifier'</span><span class="p">,</span> <span class="nx">codeVerifier</span><span class="p">)</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'grant_type'</span><span class="p">,</span> <span class="s1">'authorization_code'</span><span class="p">)</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'code'</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'redirect_uri'</span><span class="p">,</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">REDIRECT_URI</span><span class="p">))</span>

  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">BASE_URL</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">getTokens</span>
<span class="p">}</span>
</code></pre>
<p>The last step is&nbsp;to&nbsp;exchange the code which you&rsquo;re going to&nbsp;get back as&nbsp;query parameter in&nbsp;the URL and your initial code verifier to&nbsp;OAuth tokens.</p>

<blockquote>
<p>Use token service</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">tokenService</span><span class="p">.</span><span class="nx">getTokens</span><span class="p">(</span><span class="nx">payload</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">access_token</span>
  <span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id_token</span>
  <span class="kd">let</span> <span class="nx">masterKey</span> <span class="o">=</span> <span class="s1">''</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">jwt</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">jwtObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nx">masterKey</span> <span class="o">=</span> <span class="nx">jwtObj</span><span class="p">.</span><span class="nx">masterKey</span>
  <span class="p">}</span>
  <span class="c1">// At this point you have accessToken</span>
  <span class="c1">// which should be used in Bearer authorization header</span>
  <span class="c1">// to access other Mesh API endpoints</span>
<span class="p">})</span>
</code></pre><h2 id='mesh-nbsp-in-example-for-a-nbsp-simple-html-js-nbsp-page'>Mesh&nbsp;in example for a&nbsp;simple HTML/JS&nbsp;page</h2>
<blockquote>
<p>Generate button</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"meshin-button"</span> <span class="na">class=</span><span class="s">"meshin-button"</span><span class="nt">&gt;</span>mesh in<span class="nt">&lt;/button&gt;</span>
</code></pre><pre class="highlight html tab-html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://unpkg.com/@hushmesh/meshlib/dist/meshlib.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">meshApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meshlib</span><span class="p">.</span><span class="nx">Auth</span><span class="p">({</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="s1">'YOUR_CLIENT_ID'</span><span class="p">,</span>
  <span class="na">responseType</span><span class="p">:</span> <span class="s1">'code'</span><span class="p">,</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="s1">'https://beta.hushsafe.com/auth'</span><span class="p">,</span>
  <span class="nx">codeChallenge</span><span class="p">,</span>
  <span class="na">codeChallengeMethod</span><span class="p">:</span> <span class="s1">'S256'</span><span class="p">,</span>
<span class="p">})</span>
<span class="kr">const</span> <span class="nx">meshinButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'meshin-button'</span><span class="p">)</span>
<span class="nx">meshinButton</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">meshApi</span><span class="p">.</span><span class="nx">meshin</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>
<p>You can find generated button code example for your application&nbsp;on <a href="http://developer.hushmesh.com/relying-party-registration">your application page</a>.</p>

<p>Button code contains three parts:</p>

<ol>
<li>HTML for your button. You can add your own CSS or&nbsp;apply any CSS classes from your framework.</li>
<li>Script including tiny meshlib library to&nbsp;your application.</li>
<li>Library initialization with your application parameters.</li>
</ol>
<h1 id='oauth-tokens'>OAuth tokens</h1><h2 id='object-fields'>Object fields</h2>
<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c8b6935c7e864315beeb959f0043a08d"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">86364</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJhbGciOiJFUzM4NCIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsiOWgyZmhmVVZ1UzlqWjh1VmJoVjN2QzVBV1gzOUlWVVciXSwiZXhwIjoxNTkxMjc1ODQzLCJpYXQiOjE1OTEyNTc1ODMsImlzcyI6Imh0dHBzOi8vYXBpLmhzaG0uc2giLCJqdGkiOiI5aDJmaGZVVnVTOWpaOHVWYmhWM3ZDNUFXWDM5SVZVVy0wZXRyYmx2OE1rdUQ5VDk4QUtja1pnejdRcGhWRHFwUyIsIm1hc3RlcktleSI6IlFRT1kyQ25vRmlknnZ4aWVRbzh0azdBZFlCbmdMb2I0Iiwic3ViIjoiOWgyZmhmVVZ1UzlqWjh1VmJoVjN2QzVBV1gzOUlWVVctMGV0cmJsdjhNa3VEOVQ5OEFLY2taZ3o3UXBoVkRxcFMifQ._OhQZUnsN-vd31COikcqWr_YlyPhQju4wEZLRgd_QS8EqvdTPTaMI0Ww-aNVhuTKQ09fY41jiwVNgm979t0RTkelR1gM1fFmKhyFVp3uoUUDOg95SmqQS69QzSzNGPym"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"333a5730763f447594e08869401ffe22"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<p>After the exchange your authorization code and code verifier for tokens you&rsquo;re going to&nbsp;receive an&nbsp;object with few fields:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>access_token</code></td>
<td>Access token to use to access Mesh API.</td>
</tr>
<tr>
<td><code>expires_in</code></td>
<td>When current token going to be expired.</td>
</tr>
<tr>
<td><code>id_token</code></td>
<td>JWT token which contains your masterKey.</td>
</tr>
<tr>
<td><code>refresh_token</code></td>
<td>Refresh token can be used for tokens update without additional login.</td>
</tr>
<tr>
<td><code>token_type</code></td>
<td>Token type. Currently Bearer only.</td>
</tr>
</tbody></table>

<p>Two most important pieces of&nbsp;information here are:</p>

<p><code>access_token</code> &mdash; token which you have to&nbsp;use to&nbsp;access any Mesh API in&nbsp;the authorization header (without it&nbsp;you&rsquo;re going to&nbsp;have 401 error&nbsp;&mdash; anautorized).</p>

<p><code>id_token</code> &mdash; it&rsquo;s JWT token, which contains information in&nbsp;it&rsquo;s body. The most important part is&nbsp;unique masterKey, which can be&nbsp;used for different usecases (for example, as&nbsp;a&nbsp;key for your encryption/decryption process). To&nbsp;learn more about id_token structure you may want to&nbsp;take a&nbsp;look at&nbsp;our <a href="https://developer.hushmesh.com/token-viewer">token viewer</a>.</p>
<h2 id='parsing-masterkey'>Parsing masterKey</h2>
<blockquote>
<p>parse masterKey</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">idToken</span> <span class="o">=</span> <span class="s1">'your_id_token_here'</span>
<span class="kr">const</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">idToken</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">jwtObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="kr">const</span> <span class="nx">masterKey</span> <span class="o">=</span> <span class="nx">jwtObj</span><span class="p">.</span><span class="nx">masterKey</span>
</code></pre>
<p>This sample shows how to&nbsp;parse <code>masterKey</code> from <code>id_token</code>:</p>
<h1 id='application-example'>Application example</h1>
<p>In&nbsp;this section we&nbsp;are going to&nbsp;explore simple application <a href="https://hushsafe.com/">hushsafe.com</a> that demonstrates the unique security capabilities enabled by&nbsp;the mesh.</p>

<p>We&nbsp;are going to&nbsp;use mesh in&nbsp;button and auth experience, getting user&rsquo;s data and to&nbsp;use storage API.</p>
<h2 id='application-stack'>Application stack</h2>
<p>Hushsafe is&nbsp;single page application, stack we&nbsp;are using:</p>

<ul>
<li>Vue.js framework</li>
<li>Vue router as application router</li>
<li>Vuex as state management</li>
<li>axios to make API calls</li>
</ul>
<h2 id='app-registration'>App registration</h2>
<p>First step for any mesh application should be&nbsp;app registration&nbsp;in <a href="http://developer.hushmesh.com/relying-party-registration">relying parties tool</a>. Mesh in&nbsp;in&nbsp;the tool and you&rsquo;re going be&nbsp;able to&nbsp;create and manage your applications.</p>
<h2 id='mesh-in-button'>Mesh in button</h2>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">Auth</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@hushmesh/meshlib'</span>
<span class="kr">import</span> <span class="nx">crypto</span> <span class="nx">from</span> <span class="s1">'@/services/crypto'</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">codeChallenge</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">generateChallengeData</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">meshApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Auth</span><span class="p">({</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="s1">'9h2fhfUVuS9jZ8uVbhV3vC5AWX39IVUW'</span><span class="p">,</span>
  <span class="na">responseType</span><span class="p">:</span> <span class="s1">'code'</span><span class="p">,</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s1">'/callback'</span><span class="p">,</span>
  <span class="nx">codeChallenge</span><span class="p">,</span>
  <span class="na">codeChallengeMethod</span><span class="p">:</span> <span class="s1">'S256'</span><span class="p">,</span>
  <span class="na">isPopup</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">})</span>

<span class="c1">// Inside click handler</span>
<span class="nx">meshApi</span><span class="p">.</span><span class="nx">meshin</span><span class="p">()</span>
</code></pre>
<p>After successful app registration we&nbsp;can copy Mesh in&nbsp;button code example from our application page&nbsp;in <a href="https://developer.hushmesh.com/relying-party-registration">relying parties&nbsp;tool</a>.</p>

<p>You can find all information about mesh in&nbsp;button&nbsp;in <a href="http://developer.hushmesh.com/#meshin">mesh in&nbsp;section</a>.</p>

<p>On&nbsp;Hushsafe.com we&nbsp;are using exactly the approach from the mesh in&nbsp;section.</p>
<h2 id='callback-page'>Callback page</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s1">'/auth'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s1">'/auth'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>On&nbsp;Hushsafe.com we&rsquo;re using our default mesh in&nbsp;experience with&nbsp;QR code popup, because of&nbsp;that we&nbsp;need callback page which can close the popup and redirect to&nbsp;the app auth page (which responsible for the exchange of&nbsp;the code for tokens).</p>

<p>Callback page should be&nbsp;specified as <code>redirectUri</code>. Url going to&nbsp;have query string with exchange code which you should use to&nbsp;exchange code to&nbsp;the tokens.</p>

<p><code>https://hushsafe.com/auth?access_token=code=your_exchange_code</code></p>

<p>From this url we&nbsp;are grabbing code and providing it&nbsp;to&nbsp;auth page.</p>
<h2 id='auth-page'>Auth page</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$route</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">code</span>
  <span class="kr">const</span> <span class="nx">codeVerifier</span> <span class="o">=</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'code_verifier'</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'user/getTokens'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// success, at this point we have tokens</span>
      <span class="c1">// and can use any Mesh API</span>
      <span class="c1">// userinfo in this example</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'user/getUserData'</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// error</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre>
<p>At&nbsp;this point we&nbsp;already have code to&nbsp;exchange it&nbsp;to&nbsp;tokens, so&nbsp;the main goal of&nbsp;the page is&nbsp;to&nbsp;make api call to&nbsp;get tokens and depends on&nbsp;the results go&nbsp;to&nbsp;another route(on success) or&nbsp;show error message on&nbsp;error.</p>

<p>To&nbsp;learn more about token exchange see <a href="https://developer.hushmesh.com/#exchange-code-to-oauth-tokens">Exchange code to OAuth&nbsp;tokens</a>.</p>
<h2 id='getting-user-39-s-info'>Getting user&#39;s info</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">'axios'</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">'@/store'</span>

<span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/userinfo'</span>
<span class="kr">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1">// here we're setting received token to axios header</span>
<span class="kr">const</span> <span class="nx">setHeaders</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/accessToken'</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">axiosConfig</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">accessToken</span><span class="p">}</span><span class="s2">`</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">getUserData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Fetching user data like name, email etc.</span>
  <span class="nx">setHeaders</span><span class="p">()</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">BASE_URL</span><span class="p">,</span> <span class="nx">axiosConfig</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">getUserData</span>
<span class="p">}</span>

</code></pre>
<p>If&nbsp;nesessary, at&nbsp;this point we&nbsp;can get meshid in&nbsp;user&rsquo;s info with <a href="http://developer.hushmesh.com/#user">userinfo</a> api. This step is&nbsp;optional and you may skip it&nbsp;if&nbsp;you don&rsquo;t need user&rsquo;s info but only would like to&nbsp;use storage api.</p>
<h2 id='encryption'>Encryption</h2>
<blockquote>
<p>Crypto.js example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">encUTF8</span> <span class="nx">from</span> <span class="s1">'crypto-js/enc-utf8'</span>
<span class="kr">import</span> <span class="nx">AES</span> <span class="nx">from</span> <span class="s1">'crypto-js/aes'</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">'@/store'</span>

<span class="kr">const</span> <span class="nx">encrypt</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// To encrypt/decrypt values we are using user's master key</span>
  <span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/masterKey'</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">decrypt</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/masterKey'</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">AES</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="nx">encUTF8</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">encrypt</span><span class="p">,</span>
  <span class="nx">decrypt</span>
<span class="p">}</span>
</code></pre>
<p>We&nbsp;don&rsquo;t want to&nbsp;send unencrypted data, so&nbsp;we&nbsp;should prepare a&nbsp;solution to&nbsp;encrypt/decrypt data. Here we&rsquo;re using crypto.js library and our masterkey as&nbsp;a&nbsp;secret.</p>
<h2 id='fetch-and-store-data'>Fetch and store data</h2>
<blockquote>
<p>Storage API usage</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">'axios'</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">'@/store'</span>

<span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/storage'</span>

<span class="kr">const</span> <span class="nx">setHeaders</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span> <span class="na">headers</span><span class="p">:</span> <span class="p">{}</span> <span class="p">}</span>
  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/accessToken'</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">axiosConfig</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">accessToken</span><span class="p">}</span><span class="s2">`</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">axiosConfig</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">fetchData</span> <span class="o">=</span> <span class="nx">id</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// To fetch data you're going to need an object id you've created before</span>
  <span class="c1">// You can also get all object ids available for user</span>
  <span class="c1">// by GET request to BASE_URL</span>
  <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">setHeaders</span><span class="p">()</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">BASE_URL</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">storeData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// To store the data you have to provide object id</span>
  <span class="c1">// and data which can be any format including binary</span>
  <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">setHeaders</span><span class="p">()</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'Content-Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'application/json'</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">BASE_URL</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">fetchData</span><span class="p">,</span>
  <span class="nx">storeData</span>
<span class="p">}</span>
</code></pre>
<p>Now we&nbsp;can use Storage API to&nbsp;save and fetch data.</p>
<h2 id='save-data'>Save data</h2>
<blockquote>
<p>Keycard example</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"D00g0sxZ"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Keycard Title"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"U2FsdGVkX19Sm+yIbQYNf1cetF14oA62KU97GCmFU3Y="</span><span class="p">,</span><span class="w">
  </span><span class="s2">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-12T15:33:00.909Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>To&nbsp;save data we&nbsp;should provide object&nbsp;id. In&nbsp;case of&nbsp;hushsafe we&nbsp;want to&nbsp;store user&rsquo;s keycards, so&nbsp;let&rsquo;s call it &quot;keycards&quot;. Our full endpoint going to&nbsp;be
<code>https://api.hshm.sh/v0/storage/keycards</code></p>

<p>You free to&nbsp;decide what format do&nbsp;you want to&nbsp;use. In&nbsp;our case each keycard has four fields: <code>id</code>, <code>title</code>, <code>data</code>, <code>createdAt</code>. </p>

<p>As you can see, our data is&nbsp;encrypted with crypto.js.</p>
<h2 id='fetch-and-delete-nbsp-data'>Fetch and delete&nbsp;data</h2>
<p>To&nbsp;fetch data back we&rsquo;re going to&nbsp;use the same endpoint but <code>GET</code> request, or&nbsp;<code>DELETE</code>&nbsp;request for deleting
<code>https://api.hshm.sh/v0/storage/keycards</code></p>

<p><a href="http://developer.hushmesh.com/#storage">Storage API docs</a></p>
<h2 id='object-nbsp-ids-available-to-nbsp-a-nbsp-user'>Object&nbsp;IDs available to&nbsp;a&nbsp;user</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  GET https://api.hshm.sh/v0/storage
</code></pre>
<p>In&nbsp;case you want to&nbsp;get all object ids meshedin user has an&nbsp;access, you can do&nbsp;it&nbsp;by&nbsp;sending request&nbsp;to:</p>

<p><code>GET api.hshm.sh/v0/storage</code></p>
<h1 id='storage-api'>Storage API</h1><h2 id='get-object-ids'>Get object IDs</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  GET https://api.hshm.sh/v0/storage
</code></pre>
<p><code>GET api.hshm.sh/v0/storage</code></p>

<p>— lists object IDs for the meshed in user.</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"objectIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"id1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"id2"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='store-data'>Store data</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  POST https://api.hshm.sh/v0/storage/some_id
  body: <span class="o">{</span><span class="s2">"title"</span>: <span class="s2">"data"</span><span class="o">}</span>
</code></pre>
<p><code>POST api.hshm.sh/v0/storage/{object_id}</code></p>

<p>— store arbitrary data for the meshed in user.</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>object_id</code></td>
<td>String</td>
<td>Yes</td>
<td>The ID of the stored data</td>
</tr>
</tbody></table>
<h2 id='get-stored-data'>Get stored data</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  GET https://api.hshm.sh/v0/storage/some_id
</code></pre>
<p><code>GET api.hshm.sh/v0/storage/{object_id}</code></p>

<p>— fetches data that was stored for the meshed in user.</p>

<p>The data in the same format user stored previously.</p>

<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>object_id</code></td>
<td>String</td>
<td>Yes</td>
<td>The ID of the stored data</td>
</tr>
</tbody></table>
<h2 id='delete-stored-data'>Delete stored data</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  DELETE https://api.hshm.sh/v0/storage/some_id
</code></pre>
<p><code>DELETE api.hshm.sh/v0/storage/{object_id}</code></p>

<p>— deletes data that was stored for the meshed in user.</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>object_id</code></td>
<td>String</td>
<td>Yes</td>
<td>The ID of the stored data</td>
</tr>
</tbody></table>
<h1 id='user-info'>User info</h1>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  https://api.hshm.sh/v0/userinfo
</code></pre>
<p><code>GET api.hshm.sh/v0/userinfo</code></p>

<p>— retrieves user info for the access token.</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice@hushmesh.net"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre><h1 id='mesh-out'>Mesh out</h1><h2 id='header-example'>Header example</h2>
<blockquote>
<p>Header example</p>
</blockquote>
<pre class="highlight plaintext"><code>axiosConfig.headers = {
  Authorization: `Bearer [YOUR_TOKEN]`
}
</code></pre>
<p>To&nbsp;finish authorized access to&nbsp;the Mesh, you should use mesh out API. It&nbsp;is&nbsp;a&nbsp;simple <code>GET</code> call to <code>/logout</code> endpoint.</p>

<p>Please make sure to&nbsp;provide usual Bearer Authorization header, otherwise it&nbsp;is&nbsp;not going to&nbsp;work.</p>
<h2 id='meshlib'>Meshlib</h2>
<blockquote>
<p>Mesh out with meshlib</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code>  <span class="kr">import</span> <span class="nx">meshlib</span> <span class="nx">from</span> <span class="s1">'@hushmesh/meshlib'</span>

  <span class="c1">// in the handler:</span>
  <span class="nx">meshlib</span><span class="p">.</span><span class="nx">meshout</span><span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span>

</code></pre>
<p>If&nbsp;you are already using our <a href="https://www.npmjs.com/package/@hushmesh/meshlib">meshlib library</a>, you can just use <code>meshout</code> method out of&nbsp;the box.</p>

<p>Don&rsquo;t forget to&nbsp;provide a&nbsp;valid access token as&nbsp;an&nbsp;argument.</p>
<h2 id='meshout-api'>Meshout API</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  https://api.hshm.sh/v0/logout
</code></pre>
<p><code>GET api.hshm.sh/v0/logout</code></p>

<p>— finishes Mesh session.</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre><h1 id='browser-extension'>Browser extension</h1>
<p>If&nbsp;you&rsquo;re developing a&nbsp;browser extension most of&nbsp;the information related to&nbsp;web application going to&nbsp;be&nbsp;relevant. The main difference going to&nbsp;be&nbsp;mesh in&nbsp;experience. We&rsquo;re going to&nbsp;cover all differences in&nbsp;this section&nbsp;&mdash; we&rsquo;re going to&nbsp;use Chrome browser as&nbsp;an&nbsp;example.</p>
<h2 id='identity-api'>Identity API</h2>
<blockquote>
<p>Identity API:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
  <span class="kr">const</span> <span class="nx">getAuthUrl</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/init'</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">responseType</span><span class="p">,</span> <span class="nx">clientId</span><span class="p">,</span> <span class="nx">redirectUri</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">options</span>
    <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">BASE_URL</span><span class="p">}</span><span class="s2">?&amp;response_type=</span><span class="p">${</span><span class="nx">responseType</span><span class="p">}</span><span class="s2">&amp;client_id=</span><span class="p">${</span><span class="nx">clientId</span><span class="p">}</span><span class="s2">&amp;redirect_uri=`</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">redirectUri</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">url</span>
  <span class="p">}</span>

  <span class="kr">const</span> <span class="nx">meshin</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">codeChallenge</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">generateChallengeData</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">redirectUri</span> <span class="o">=</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">identity</span><span class="p">.</span><span class="nx">getRedirectURL</span><span class="p">()</span>
      <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">getAuthUrl</span><span class="p">({</span>
        <span class="na">clientId</span><span class="p">:</span> <span class="s1">'YOUR_APP_CLIENT_ID'</span><span class="p">,</span>
        <span class="na">responseType</span><span class="p">:</span> <span class="s1">'code'</span><span class="p">,</span>
        <span class="nx">redirectUri</span><span class="p">,</span>
        <span class="nx">codeChallenge</span><span class="p">,</span>
        <span class="na">codeChallengeMethod</span><span class="p">:</span> <span class="s1">'S256'</span><span class="p">,</span>
      <span class="p">})</span>

      <span class="nx">chrome</span><span class="p">.</span><span class="nx">identity</span><span class="p">.</span><span class="nx">launchWebAuthFlow</span><span class="p">({</span>
        <span class="nx">url</span><span class="p">,</span>
        <span class="na">interactive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">},</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">getUrlParameter</span><span class="p">(</span><span class="s1">'code'</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span>

        <span class="c1">// From there logic is exactly the same as for web app</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">tokenApi</span><span class="p">.</span><span class="nx">getTokens</span><span class="p">({</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">access_token</span>
            <span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id_token</span>
            <span class="kd">let</span> <span class="nx">masterKey</span> <span class="o">=</span> <span class="s1">''</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">jwt</span><span class="p">)</span> <span class="p">{</span>
              <span class="kr">const</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
              <span class="kr">const</span> <span class="nx">jwtObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
              <span class="nx">masterKey</span> <span class="o">=</span> <span class="nx">jwtObj</span><span class="p">.</span><span class="nx">masterKey</span>
            <span class="p">}</span>
            <span class="nx">resolve</span><span class="p">({</span> <span class="nx">accessToken</span><span class="p">,</span> <span class="nx">masterKey</span> <span class="p">})</span>
          <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
          <span class="p">})</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">reject</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre>
<p>In&nbsp;browser extensions we&nbsp;cannot use the same callback flow as&nbsp;per web applications. Usually your browser extension will have url similar to <code>chrome-extension://npmgajiaihfjibkgojndemlehpalicjc/home.html</code> and we&nbsp;cannot open such url as&nbsp;a&nbsp;callback because of&nbsp;security restrictions.</p>

<p>Instead of&nbsp;the callback we&nbsp;should use browser&rsquo;s <a href="https://developer.chrome.com/apps/identity">identity API</a> and receive our tokens information in&nbsp;the response.</p>

<p>Let&rsquo;w walk through the code example:</p>

<ul>
<li><p>First we&nbsp;create <code>codeChallenge</code> and <code>codeVerifier</code> the same way as&nbsp;per web application&nbsp;&mdash; we&rsquo;re still going to&nbsp;need them.</p></li>
<li><p>We&rsquo;re getting redirect url using <code>identity.getRedirectURL()</code> method.</p></li>
<li><p>We&rsquo;re creating url for API call with our application parameters. Make sure to&nbsp;use your real application <code>clientId</code> here from relying party registration tool.</p></li>
<li><p>Then we&rsquo;re launching auth flow using <code>identity.launchWebAuthFlow()</code> method.</p></li>
<li><p>After successful mesh in&nbsp;we&rsquo;re getting back code which we&nbsp;should exchange to&nbsp;tokens&nbsp;&mdash; this logic is&nbsp;exactly the same as&nbsp;for the web and you can find more details about it&nbsp;in <a href="https://developer.hushmesh.com/#oauth-tokens">OAuth tokens</a> section.</p></li>
</ul>
<h2 id='caveats'>Caveats</h2>
<p>To&nbsp;store tokens and <code>masterKey</code> it&rsquo;s better to&nbsp;use your extension background. If&nbsp;you&rsquo;re going to&nbsp;put them in&nbsp;the popup, they&rsquo;re going to&nbsp;be&nbsp;cleared every time user is&nbsp;closing popup.</p>
<h1 id='errors'>Errors</h1>
<p>The HTTP error codes returned:</p>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Missing/invalid fields in the request</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized, additional credentials needed</td>
</tr>
<tr>
<td>403</td>
<td>Permission denied</td>
</tr>
<tr>
<td>404</td>
<td>Resource not found</td>
</tr>
<tr>
<td>406</td>
<td>Unhandled message type</td>
</tr>
<tr>
<td>409</td>
<td>Conflict</td>
</tr>
<tr>
<td>500</td>
<td>Internal server error</td>
</tr>
</tbody></table>



        <div class="contact">
          <h2 class="text-primary">
            Not finding the information you need?
          </h2>
          <p>
            Contact us <a href="mailto:info@mesh.in" class="link-external">info@mesh.in</a>
          </p>
        </div>
        <footer>
          <p class="update-notice">
            Last updated Aug 13, 2020
          </p>
          © 2019–2020 Hushmesh Inc., a Delaware Public Benefit Corporation
        </footer>
      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
