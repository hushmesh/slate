
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Twist API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen-cc29d98d.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-e3e96727.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-c5541673.js"></script>
  </head>

  <body class="index" data-languages="[]">

    <header class="site-header">
      <a href="/" class="site-logo">
        <img src="images/logo-6e2835f0.png" alt="Logo" />
      </a>
      <nav class="site-nav index">
        <a href="https://developer.hushmesh.com/">Manage your apps</a>
      </nav>
    </header>

    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-6e2835f0.png" class="logo" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#what-is-the-mesh" class="toc-h2 toc-link" data-title="What is the Mesh?">What is the Mesh?</a>
                  </li>
                  <li>
                    <a href="#what-you-can-do-as-a-developer" class="toc-h2 toc-link" data-title="What you can do as a developer?">What you can do as a developer?</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#authentication" class="toc-h1 toc-link" data-title="Authentication">Authentication</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#auth" class="toc-h2 toc-link" data-title="Auth">Auth</a>
                  </li>
                  <li>
                    <a href="#response-types" class="toc-h2 toc-link" data-title="Response types">Response types</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#meshin" class="toc-h1 toc-link" data-title="Meshin">Meshin</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#meshin-button" class="toc-h2 toc-link" data-title="Meshin button">Meshin button</a>
                  </li>
                  <li>
                    <a href="#javascript-frameworks-compatibility" class="toc-h2 toc-link" data-title="JavaScript frameworks compatibility">JavaScript frameworks compatibility</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#user-info" class="toc-h1 toc-link" data-title="User info">User info</a>
          </li>
          <li>
            <a href="#storage-api" class="toc-h1 toc-link" data-title="Storage API">Storage API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-object-ids" class="toc-h2 toc-link" data-title="Get Object Ids">Get Object Ids</a>
                  </li>
                  <li>
                    <a href="#store-data" class="toc-h2 toc-link" data-title="Store data">Store data</a>
                  </li>
                  <li>
                    <a href="#get-stored-data" class="toc-h2 toc-link" data-title="Get stored data">Get stored data</a>
                  </li>
                  <li>
                    <a href="#delete-stored-data" class="toc-h2 toc-link" data-title="Delete stored data">Delete stored data</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#alpplication-example" class="toc-h1 toc-link" data-title="Alpplication example">Alpplication example</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#application-stack" class="toc-h2 toc-link" data-title="Application stack">Application stack</a>
                  </li>
                  <li>
                    <a href="#app-registration" class="toc-h2 toc-link" data-title="App registration">App registration</a>
                  </li>
                  <li>
                    <a href="#meshin-button" class="toc-h2 toc-link" data-title="Meshin button">Meshin button</a>
                  </li>
                  <li>
                    <a href="#redirect-page" class="toc-h2 toc-link" data-title="Redirect page">Redirect page</a>
                  </li>
                  <li>
                    <a href="#getting-user-39-s-info" class="toc-h2 toc-link" data-title="Getting user's info">Getting user's info</a>
                  </li>
                  <li>
                    <a href="#encryption" class="toc-h2 toc-link" data-title="Encryption">Encryption</a>
                  </li>
                  <li>
                    <a href="#storage-api" class="toc-h2 toc-link" data-title="Storage API">Storage API</a>
                  </li>
                  <li>
                    <a href="#save-data" class="toc-h2 toc-link" data-title="Save data">Save data</a>
                  </li>
                  <li>
                    <a href="#fetch-and-delete-data" class="toc-h2 toc-link" data-title="Fetch and Delete data">Fetch and Delete data</a>
                  </li>
              </ul>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>This is the official documentation of the HushMesh API.</p>
<h2 id='what-is-the-mesh'>What is the Mesh?</h2>
<p>The mesh is the &quot;trust network&quot;. Much like social networks, the mesh enables digital interactions between people and organizations. But unlike traditional social networks, the mesh does not target a specific application or mode of communication. Rather, it is designed from the ground up as a neutral platform to enable digital trust and privacy as a service to all other applications, websites, services and devices, for everyone and every organization.</p>
<h2 id='what-you-can-do-as-a-developer'>What you can do as a developer?</h2>
<p>You can create applications in the portal and use the mesh for your usecases.</p>

<p>Examples: ...</p>
<h1 id='authentication'>Authentication</h1>
<p>In order to make authorized calls to the Mesh, you must first obtain an access token. This section describes how to obtain such a token.</p>
<h2 id='auth'>Auth</h2>
<p>Before getting started, you need to <a href="http://developer.hushmesh.com/">create an app</a> and configure a valid redirect URL. A registered HushMesh integration is assigned a unique Client ID and Client Secret which are needed for the OAuth2 flow.</p>
<h3 id='the-authorization-request'>The authorization request</h3>
<p>Redirect users to the authorization URL at the endpoint <code>https://api.hshm.sh/v0/init</code>, with the specified request parameters. After successful authorization, an access_token going to be available as a query parameter and should be used to make API calls to other Mesh endpoints</p>

<p>Here follow the required parameters:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>client_id</td>
<td>The unique Client ID of the Mesh integration that you registered.</td>
</tr>
<tr>
<td>response_type</td>
<td>A comma separated list of permissions that you would like the users to grant to your integration. See below a table with more details about this.</td>
</tr>
<tr>
<td>redirect_uri</td>
<td>A unique and unguessable string. It is used to protect you against cross-site request forgery attacks.</td>
</tr>
</tbody></table>

<p>And here are some common errors that you may encounter (you will find more info in <code>error.error_message</code>):</p>

<table><thead>
<tr>
<th>Error</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>FORBIDDEN</td>
<td>A permissions issue happened</td>
</tr>
<tr>
<td>BAD_REQUEST</td>
<td>The request was badly formatted, for example, if you supply an invalid <code>response_type</code></td>
</tr>
</tbody></table>
<h2 id='response-types'>Response types</h2>
<p>These are the response types available for your integration:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>code</td>
<td>Code</td>
</tr>
<tr>
<td>token</td>
<td>Token</td>
</tr>
<tr>
<td>id_token</td>
<td>id_token</td>
</tr>
</tbody></table>
<h1 id='meshin'>Meshin</h1>
<p>Before getting started, you need to <a href="http://developer.hushmesh.com/">create an app</a> and configure a valid redirect URL. A registered HushMesh integration is assigned a unique Client ID and Client Secret which are needed for the OAuth2 flow.</p>

<p>To autorize user to the mesh as a developer you have two options: use API endpoint directly as explained in authentication section or use our meshin button.</p>

<p>If you&#39;re going to use meshin button, you&#39;re going to have better mobile device meshin experience out of the box (direct Meshin application opening on mobile devices instead of QR code)</p>
<h2 id='meshin-button'>Meshin button</h2>
<p>You can find generated button code for your application on your application page on <a href="http://developer.hushmesh.com/">https://developer.hushmesh.com</a></p>

<blockquote>
<p>First part:</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"meshin-button"</span> <span class="na">class=</span><span class="s">"meshin-button"</span><span class="nt">&gt;</span>meshin<span class="nt">&lt;/button&gt;</span>
</code></pre>
<p>Button code contains three parts:</p>

<p>First part is HTML for your button. You can add your own CSS or apply any CSS classes from your framework</p>

<blockquote>
<p>Second part:</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://developer.hushmesh.com/meshlib.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
<p>Second part includes tiny meshin library to your application</p>

<blockquote>
<p>Third part:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">Meshlib</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meshlib</span><span class="p">({</span>
    <span class="na">clientId</span><span class="p">:</span> <span class="s1">'demo'</span><span class="p">,</span>
    <span class="na">responseType</span><span class="p">:</span> <span class="s1">'token_id_token'</span><span class="p">,</span>
    <span class="na">redirectUri</span><span class="p">:</span> <span class="s1">'https://beta.hushsafe.com/auth'</span>
  <span class="p">}).</span><span class="nx">init</span><span class="p">()</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre>
<p>Third part is library initialization with your application parameters</p>
<h2 id='javascript-frameworks-compatibility'>JavaScript frameworks compatibility</h2>
<blockquote>
<p>Include an init:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">Meshlib</span> <span class="nx">from</span> <span class="s1">'@/assets/js/meshlib'</span>
<span class="kr">const</span> <span class="nx">meshApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meshlib</span><span class="p">({</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="s1">'demo'</span><span class="p">,</span>
  <span class="na">responseType</span><span class="p">:</span> <span class="s1">'token_id_token'</span><span class="p">,</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="s1">'https://beta.hushsafe.com/auth'</span>
<span class="p">})</span>
</code></pre>
<p>If you are using any modern JavaScript framework, you may want to use slightly different approach.</p>

<p>You can create meshin button component and inside the component include and initialize meshin library</p>

<blockquote>
<p>Inside handler:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">meshApi</span><span class="p">.</span><span class="nx">meshin</span><span class="p">()</span>
</code></pre>
<p>After that you just need to use meshin method inside your on click handler:</p>
<h1 id='user-info'>User info</h1>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  https://api.hshm.sh/v0/userinfo
</code></pre>
<p><code>GET api.hshm.sh/v0/userinfo</code></p>

<p>Retrieves user info for the access token</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice@hushmesh.net"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre><h1 id='storage-api'>Storage API</h1><h2 id='get-object-ids'>Get Object Ids</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  GET https://api.hshm.sh/v0/storage
</code></pre>
<p><code>GET api.hshm.sh/v0/storage</code></p>

<p>Lists object ids for the meshed in user</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"objectIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"id1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"id2"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='store-data'>Store data</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  POST https://api.hshm.sh/v0/storage/some_id
  body: <span class="o">{</span><span class="s2">"title"</span>: <span class="s2">"data"</span><span class="o">}</span>
</code></pre>
<p><code>POST api.hshm.sh/v0/storage/{object_id}</code></p>

<p>Store arbitrary data for the meshed in user</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='parameters'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>object_id</td>
<td>String</td>
<td>Yes</td>
<td>The id of the stored data</td>
</tr>
</tbody></table>
<h2 id='get-stored-data'>Get stored data</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  GET https://api.hshm.sh/v0/storage/some_id
</code></pre>
<p><code>GET api.hshm.sh/v0/storage/{object_id}</code></p>

<p>Fetch data that was stored for the meshed in user</p>

<blockquote>
<p>Return object</p>
</blockquote>

<p>The data in the same format user stored previously</p>
<h3 id='parameters-2'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>object_id</td>
<td>String</td>
<td>Yes</td>
<td>The id of the stored data</td>
</tr>
</tbody></table>
<h2 id='delete-stored-data'>Delete stored data</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  DELETE https://api.hshm.sh/v0/storage/some_id
</code></pre>
<p><code>DELETE api.hshm.sh/v0/storage/{object_id}</code></p>

<p>Delete data that was stored for the meshed in user.</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='parameters-3'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>object_id</td>
<td>String</td>
<td>Yes</td>
<td>The id of the stored data</td>
</tr>
</tbody></table>
<h1 id='alpplication-example'>Alpplication example</h1>
<p>In this section we are going to explore simple application  <a href="https://hushsafe.com/">hushsafe.com</a> that demonstrates the unique security capabilities enabled by the mesh.</p>

<p>We are going to use meshin button and auth experience, getting user&#39;s data and to use storage API.</p>
<h2 id='application-stack'>Application stack</h2>
<p>Hushsafe is single page application, stack we are using:
* Vue.js framework
* Vue router as application router
* Vuex as state management
* axios to make API calls</p>
<h2 id='app-registration'>App registration</h2>
<p>First step for any mesh application should be app registration in <a href="http://developer.hushmesh.com/relying-parties">relying parties tool</a>. Meshin in the tool and you&#39;re going be able to create and manage your applications.</p>
<h2 id='meshin-button'>Meshin button</h2>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">Meshlib</span> <span class="nx">from</span> <span class="s1">'@/assets/js/meshlib'</span>
<span class="kr">const</span> <span class="nx">meshApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meshlib</span><span class="p">({</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="s1">'demo'</span><span class="p">,</span>
  <span class="na">responseType</span><span class="p">:</span> <span class="s1">'token_id_token'</span><span class="p">,</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="s1">'https://beta.hushsafe.com/auth'</span>
<span class="p">})</span>

<span class="c1">// Inside click handler</span>
<span class="nx">meshApi</span><span class="p">.</span><span class="nx">meshin</span><span class="p">()</span>
</code></pre>
<p>After successful app registration we can copy Meshin button code from our application page in <a href="http://developer.hushmesh.com/relying-parties">relying parties tool</a></p>

<p>You can find all information about meshin button in <a href="http://developer.hushmesh.com/#meshin">meshin section</a></p>

<p>On Hushsafe.com we are using approach from &quot;JavaScript frameworks compatibility&quot; section</p>
<h2 id='redirect-page'>Redirect page</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// getting tokens data</span>
  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$route</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">access_token</span>
  <span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$route</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">id_token</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="c1">// save access token</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'user/setAccessToken'</span><span class="p">,</span> <span class="nx">accessToken</span><span class="p">)</span>
    <span class="c1">// now with the token we can get user data</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'user/getUserData'</span><span class="p">)</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="p">})</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">jwt</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">jwtObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1">// save master key to use it for encoding/decoding data</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'user/setMasterKey'</span><span class="p">,</span> <span class="nx">jwtObj</span><span class="p">.</span><span class="nx">masterKey</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>After successful meshin we are getting back to redirect page, which we specified in button meshin parameters as <code>redirectUri</code>. Url going to have query string with data which we are going to use in our application.</p>

<p><code>https://hushsafe.com/auth?access_token=token_here&amp;id_token=id_token_data</code></p>

<p>From this url we are grabbing tokens data and saving it to use later</p>
<h2 id='getting-user-39-s-info'>Getting user&#39;s info</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">'axios'</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">'@/store'</span>

<span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/userinfo'</span>
<span class="kr">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1">// here we're setting received token to axios header</span>
<span class="kr">const</span> <span class="nx">setHeaders</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/accessToken'</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">axiosConfig</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">accessToken</span><span class="p">}</span><span class="s2">`</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">getUserData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Fetching user data like name, email etc.</span>
  <span class="nx">setHeaders</span><span class="p">()</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">BASE_URL</span><span class="p">,</span> <span class="nx">axiosConfig</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">getUserData</span>
<span class="p">}</span>

</code></pre>
<p>If nesessary, at this point we can get meshid in user&#39;s info with <a href="http://developer.hushmesh.com/#user">userinfo</a> api. This step is optional and you may skip it if you don&#39;t need user&#39;s info but only would like to use storage api.</p>
<h2 id='encryption'>Encryption</h2>
<blockquote>
<p>Crypto.js example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">encUTF8</span> <span class="nx">from</span> <span class="s1">'crypto-js/enc-utf8'</span>
<span class="kr">import</span> <span class="nx">AES</span> <span class="nx">from</span> <span class="s1">'crypto-js/aes'</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">'@/store'</span>

<span class="kr">const</span> <span class="nx">encrypt</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// To encrypt/decrypt values we are using user's master key</span>
  <span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/masterKey'</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">decrypt</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/masterKey'</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">AES</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="nx">encUTF8</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">encrypt</span><span class="p">,</span>
  <span class="nx">decrypt</span>
<span class="p">}</span>
</code></pre>
<p>We don&#39;t want to send unencrypted data, so we should prepare a solytion to encrypt/decrypt data. Here we&#39;re using crypto.js library and our masterkey as a secret.</p>
<h2 id='storage-api'>Storage API</h2>
<blockquote>
<p>Storage api usage</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">'axios'</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">'@/store'</span>

<span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/storage'</span>

<span class="kr">const</span> <span class="nx">setHeaders</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span> <span class="na">headers</span><span class="p">:</span> <span class="p">{}</span> <span class="p">}</span>
  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/accessToken'</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">axiosConfig</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">accessToken</span><span class="p">}</span><span class="s2">`</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">axiosConfig</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">fetchData</span> <span class="o">=</span> <span class="nx">id</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// To fetch data you're going to need an object id you've created before</span>
  <span class="c1">// You can also get all object ids available for user</span>
  <span class="c1">// by GET request to BASE_URL</span>
  <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">setHeaders</span><span class="p">()</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">BASE_URL</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">storeData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// To store the data you have to provide object id</span>
  <span class="c1">// and data which can be any format including binary</span>
  <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">setHeaders</span><span class="p">()</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'Content-Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'application/json'</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">BASE_URL</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">fetchData</span><span class="p">,</span>
  <span class="nx">storeData</span>
<span class="p">}</span>
</code></pre>
<p>Now we can use storage api to save and fetch data</p>
<h2 id='save-data'>Save data</h2>
<blockquote>
<p>Keycard example</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"D00g0sxZ"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Keycard Title"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"U2FsdGVkX19Sm+yIbQYNf1cetF14oA62KU97GCmFU3Y="</span><span class="p">,</span><span class="w">
  </span><span class="s2">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-12T15:33:00.909Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>To save data we should provide object id. In case of hushsafe we want to store user&#39;s keycards, so let&#39;s call it &#39;keycards&#39;.
Our full endpoint going to be
<code>https://api.hshm.sh/v0/storage/keycards</code></p>

<p>You free to decide what format do you want to use. In our case each keycard has four fields: id, title, data, createdAt.
As you can see, our data is encrypted with crypto.js</p>
<h2 id='fetch-and-delete-data'>Fetch and Delete data</h2>
<p>To fetch data back we&#39;re going to use the same endpoint but GET request, to delete - DELETE request
<code>https://api.hshm.sh/v0/storage/keycards</code></p>

<p><a href="http://developer.hushmesh.com/#storage">Storage api docs</a></p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
