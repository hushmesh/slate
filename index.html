
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>HusmMesh API Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen-0c100073.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-e3e96727.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-c5541673.js"></script>
  </head>

  <body class="index" data-languages="[]">

    <header class="site-header">
      <a href="/" class="site-logo">
        <img src="images/logo-6e2835f0.png" alt="Logo" />
      </a>
      <nav class="site-nav index">
        <a href="https://developer.hushmesh.com/relying-party-registration">Manage your apps</a>
        <a href="https://developer.hushmesh.com/token-viewer">View token structure</a>
      </nav>
    </header>

    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#what-is-the-mesh" class="toc-h2 toc-link" data-title="What is the Mesh?">What is the Mesh?</a>
                  </li>
                  <li>
                    <a href="#what-you-can-do-as-a-developer" class="toc-h2 toc-link" data-title="What you can do as a developer?">What you can do as a developer?</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#meshin" class="toc-h1 toc-link" data-title="Meshin">Meshin</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#meshin-button" class="toc-h2 toc-link" data-title="Meshin button">Meshin button</a>
                  </li>
                  <li>
                    <a href="#how-to-generate-code-challenge-and-code-verifier" class="toc-h2 toc-link" data-title="How to generate code challenge and code verifier">How to generate code challenge and code verifier</a>
                  </li>
                  <li>
                    <a href="#exchange-code-to-oauth-tokens" class="toc-h2 toc-link" data-title="Exchange code to oauth tokens">Exchange code to oauth tokens</a>
                  </li>
                  <li>
                    <a href="#javascript-frameworks-compatibility" class="toc-h2 toc-link" data-title="JavaScript frameworks compatibility">JavaScript frameworks compatibility</a>
                  </li>
                  <li>
                    <a href="#meshin-without-meshlib" class="toc-h2 toc-link" data-title="Meshin without meshlib">Meshin without meshlib</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#oauth-tokens" class="toc-h1 toc-link" data-title="Oauth tokens">Oauth tokens</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-to-parse-masterkey-from-id_token" class="toc-h2 toc-link" data-title="How to parse masterKey from id_token:">How to parse masterKey from id_token:</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#alpplication-example" class="toc-h1 toc-link" data-title="Alpplication example">Alpplication example</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#application-stack" class="toc-h2 toc-link" data-title="Application stack">Application stack</a>
                  </li>
                  <li>
                    <a href="#app-registration" class="toc-h2 toc-link" data-title="App registration">App registration</a>
                  </li>
                  <li>
                    <a href="#meshin-button" class="toc-h2 toc-link" data-title="Meshin button">Meshin button</a>
                  </li>
                  <li>
                    <a href="#callback-page" class="toc-h2 toc-link" data-title="Callback page">Callback page</a>
                  </li>
                  <li>
                    <a href="#auth-page" class="toc-h2 toc-link" data-title="Auth page">Auth page</a>
                  </li>
                  <li>
                    <a href="#getting-user-39-s-info" class="toc-h2 toc-link" data-title="Getting user's info">Getting user's info</a>
                  </li>
                  <li>
                    <a href="#encryption" class="toc-h2 toc-link" data-title="Encryption">Encryption</a>
                  </li>
                  <li>
                    <a href="#storage-api" class="toc-h2 toc-link" data-title="Storage API">Storage API</a>
                  </li>
                  <li>
                    <a href="#save-data" class="toc-h2 toc-link" data-title="Save data">Save data</a>
                  </li>
                  <li>
                    <a href="#fetch-and-delete-data" class="toc-h2 toc-link" data-title="Fetch and Delete data">Fetch and Delete data</a>
                  </li>
                  <li>
                    <a href="#object-ids-available-to-user" class="toc-h2 toc-link" data-title="Object Ids available to user">Object Ids available to user</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#storage-api" class="toc-h1 toc-link" data-title="Storage API">Storage API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-object-ids" class="toc-h2 toc-link" data-title="Get Object Ids">Get Object Ids</a>
                  </li>
                  <li>
                    <a href="#store-data" class="toc-h2 toc-link" data-title="Store data">Store data</a>
                  </li>
                  <li>
                    <a href="#get-stored-data" class="toc-h2 toc-link" data-title="Get stored data">Get stored data</a>
                  </li>
                  <li>
                    <a href="#delete-stored-data" class="toc-h2 toc-link" data-title="Delete stored data">Delete stored data</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#user-info" class="toc-h1 toc-link" data-title="User info">User info</a>
          </li>
          <li>
            <a href="#meshout" class="toc-h1 toc-link" data-title="Meshout">Meshout</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#meshout-api" class="toc-h2 toc-link" data-title="Meshout API">Meshout API</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#browser-extension" class="toc-h1 toc-link" data-title="Browser extension">Browser extension</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#meshin-browser-extension" class="toc-h2 toc-link" data-title="Meshin browser extension">Meshin browser extension</a>
                  </li>
                  <li>
                    <a href="#caveats" class="toc-h2 toc-link" data-title="Caveats">Caveats</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>This is the official documentation of the HushMesh API.</p>
<h2 id='what-is-the-mesh'>What is the Mesh?</h2>
<p>The mesh is the &quot;trust network&quot;. Much like social networks, the mesh enables digital interactions between people and organizations. But unlike traditional social networks, the mesh does not target a specific application or mode of communication. Rather, it is designed from the ground up as a neutral platform to enable digital trust and privacy as a service to all other applications, websites, services and devices, for everyone and every organization.</p>
<h2 id='what-you-can-do-as-a-developer'>What you can do as a developer?</h2>
<p>You can create applications in the portal and use the mesh for your usecases.</p>
<h1 id='meshin'>Meshin</h1>
<p>In order to make authorized calls to the Mesh, you must first obtain an access token. This section describes how to obtain such a token.</p>

<p>Before getting started, you need to <a href="http://developer.hushmesh.com/relying-party-registration">create an app</a> and configure a valid redirect URL. A registered HushMesh integration is assigned a unique Client ID and Client Secret which are needed for the OAuth2 flow.</p>

<p>To autorize user to the mesh as a developer you have two options: use API endpoint directly as explained in authentication section or use our meshin button.</p>

<p>If you&#39;re going to use meshlib, you&#39;re going to have better mobile device meshin experience out of the box (direct Meshin application opening on mobile devices instead of QR code)</p>
<h2 id='meshin-button'>Meshin button</h2>
<p>You can find generated button code for your application on <a href="http://developer.hushmesh.com/relying-party-registration">your application page</a></p>

<blockquote>
<p>First part:</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"meshin-button"</span> <span class="na">class=</span><span class="s">"meshin-button"</span><span class="nt">&gt;</span>meshin<span class="nt">&lt;/button&gt;</span>
</code></pre>
<p>Button code contains three parts:</p>

<p>First part is HTML for your button. You can add your own CSS or apply any CSS classes from your framework</p>

<blockquote>
<p>Second part:</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://developer.hushmesh.com/relying-party-registration/meshlib-pkce.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
<p>Second part includes tiny meshin library to your application</p>

<blockquote>
<p>Third part:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
  <span class="kr">const</span> <span class="nx">meshApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meshlib</span><span class="p">({</span>
    <span class="na">clientId</span><span class="p">:</span> <span class="s1">'YOUR_CLIENT_ID'</span><span class="p">,</span>
    <span class="na">responseType</span><span class="p">:</span> <span class="s1">'code'</span><span class="p">,</span>
    <span class="na">redirectUri</span><span class="p">:</span> <span class="s1">'https://beta.hushsafe.com/auth'</span><span class="p">,</span>
    <span class="nx">codeChallenge</span><span class="p">,</span>
    <span class="na">codeChallengeMethod</span><span class="p">:</span> <span class="s1">'S256'</span><span class="p">,</span>
  <span class="p">})</span>
  <span class="kr">const</span> <span class="nx">meshinButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'meshin-button'</span><span class="p">)</span>
  <span class="nx">meshinButton</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">meshApi</span><span class="p">.</span><span class="nx">meshin</span><span class="p">()</span>
  <span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre>
<p>Third part is library initialization with your application parameters</p>
<h2 id='how-to-generate-code-challenge-and-code-verifier'>How to generate code challenge and code verifier</h2>
<p>In order to get user tokens first you have to obtain the authorization code. Next you can exchange your authorization code and code verifier for tokens.</p>

<blockquote>
<p>Generate challenge data example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">CryptoJS</span> <span class="nx">from</span> <span class="s1">'crypto-js'</span>

<span class="kr">const</span> <span class="nx">generateChallengeData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">codeVerifier</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">lib</span><span class="p">.</span><span class="nx">WordArray</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">128</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Base64</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">codeChallenge</span> <span class="o">=</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Base64</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">sha256</span><span class="p">(</span><span class="nx">codeVerifier</span><span class="p">)).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/=/g</span><span class="p">,</span> <span class="s1">''</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\+</span><span class="sr">/g</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\/</span><span class="sr">/g</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">{</span> <span class="nx">codeVerifier</span><span class="p">,</span> <span class="nx">codeChallenge</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre><h2 id='exchange-code-to-oauth-tokens'>Exchange code to oauth tokens</h2>
<p>The last step is to exchange the code which you&#39;re going to get back as query parameter in the url and your initial code verifier to oauth tokens</p>

<blockquote>
<p>Token service example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">'axios'</span>

<span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/getToken'</span>
<span class="kr">const</span> <span class="nx">CLIENT_ID</span> <span class="o">=</span> <span class="s1">'YOUR_CLIENT_ID'</span>
<span class="kr">const</span> <span class="nx">REDIRECT_URI</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span>

<span class="kr">const</span> <span class="nx">getTokens</span> <span class="o">=</span> <span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">payload</span>

  <span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">()</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'client_id'</span><span class="p">,</span> <span class="nx">CLIENT_ID</span><span class="p">)</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'code_verifier'</span><span class="p">,</span> <span class="nx">codeVerifier</span><span class="p">)</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'grant_type'</span><span class="p">,</span> <span class="s1">'authorization_code'</span><span class="p">)</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'code'</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'redirect_uri'</span><span class="p">,</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">REDIRECT_URI</span><span class="p">))</span>

  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">BASE_URL</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">getTokens</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Use token service</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">tokenService</span><span class="p">.</span><span class="nx">getTokens</span><span class="p">(</span><span class="nx">payload</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">access_token</span>
  <span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id_token</span>
  <span class="kd">let</span> <span class="nx">masterKey</span> <span class="o">=</span> <span class="s1">''</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">jwt</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">jwtObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nx">masterKey</span> <span class="o">=</span> <span class="nx">jwtObj</span><span class="p">.</span><span class="nx">masterKey</span>
  <span class="p">}</span>
  <span class="c1">// At this point you have accessToken</span>
  <span class="c1">// which should be used in Bearer authorization header</span>
  <span class="c1">// to access other Mesh API endpoints</span>
<span class="p">})</span>
</code></pre><h2 id='javascript-frameworks-compatibility'>JavaScript frameworks compatibility</h2>
<blockquote>
<p>Include an init:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">Meshlib</span> <span class="nx">from</span> <span class="s1">'@/assets/js/meshlib'</span>
<span class="kr">const</span> <span class="nx">meshApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meshlib</span><span class="p">({</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="s1">'YOUR_CLIENT_ID'</span><span class="p">,</span>
  <span class="na">responseType</span><span class="p">:</span> <span class="s1">'code'</span><span class="p">,</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="s1">'https://beta.hushsafe.com/auth'</span><span class="p">,</span>
  <span class="nx">codeChallenge</span><span class="p">,</span>
  <span class="na">codeChallengeMethod</span><span class="p">:</span> <span class="s1">'S256'</span><span class="p">,</span>
<span class="p">})</span>
</code></pre>
<p>If you are using any modern JavaScript framework, you may want to use slightly different approach.</p>

<p>You can create meshin button component and inside the component include and initialize meshin library. You can <a href="https://developer.hushmesh.com/relying-party-registration/meshlib-pkce.js">download meshlib</a> and include it in your project.</p>

<blockquote>
<p>Inside handler:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">meshApi</span><span class="p">.</span><span class="nx">meshin</span><span class="p">()</span>
</code></pre>
<p>After that you just need to use meshin method inside your on click handler:</p>
<h2 id='meshin-without-meshlib'>Meshin without meshlib</h2>
<p>In case you don&#39;t want to use our meshlib library, you can implement meshin experience by yourself.</p>

<p>As an additional step first you&#39;re going to need to redirect users to <code>https://api.hshm.sh/v0/authorize</code>, with the specified request parameters. After successful callback the flow is the same as per ususal Meshin experience</p>

<p>For code examples see <a href="https://developer.hushmesh.com/relying-party-registration/meshlib-pkce.js">meshlib source code</a></p>
<h1 id='oauth-tokens'>Oauth tokens</h1>
<p>After the exchange your authorization code and code verifier for tokens you&#39;re going to receive an object with few fields:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>access_token</td>
<td>Access token to use to access Mesh API</td>
</tr>
<tr>
<td>expires_in</td>
<td>When current token going to be expired</td>
</tr>
<tr>
<td>id_token</td>
<td>JWT token which contains your masterKey</td>
</tr>
<tr>
<td>refresh_token</td>
<td>Refresh token can be used for tokens update without additional login</td>
</tr>
<tr>
<td>token_type</td>
<td>Token type. Currently Bearer only.</td>
</tr>
</tbody></table>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c8b6935c7e864315beeb959f0043a08d"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">86364</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJhbGciOiJFUzM4NCIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsiOWgyZmhmVVZ1UzlqWjh1VmJoVjN2QzVBV1gzOUlWVVciXSwiZXhwIjoxNTkxMjc1ODQzLCJpYXQiOjE1OTEyNTc1ODMsImlzcyI6Imh0dHBzOi8vYXBpLmhzaG0uc2giLCJqdGkiOiI5aDJmaGZVVnVTOWpaOHVWYmhWM3ZDNUFXWDM5SVZVVy0wZXRyYmx2OE1rdUQ5VDk4QUtja1pnejdRcGhWRHFwUyIsIm1hc3RlcktleSI6IlFRT1kyQ25vRmlknnZ4aWVRbzh0azdBZFlCbmdMb2I0Iiwic3ViIjoiOWgyZmhmVVZ1UzlqWjh1VmJoVjN2QzVBV1gzOUlWVVctMGV0cmJsdjhNa3VEOVQ5OEFLY2taZ3o3UXBoVkRxcFMifQ._OhQZUnsN-vd31COikcqWr_YlyPhQju4wEZLRgd_QS8EqvdTPTaMI0Ww-aNVhuTKQ09fY41jiwVNgm979t0RTkelR1gM1fFmKhyFVp3uoUUDOg95SmqQS69QzSzNGPym"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"333a5730763f447594e08869401ffe22"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="s2">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<p>Two most important pieces of information here are:</p>

<ul>
<li><p>access_token - token which you have to use to access any Mesh API in the authorization header (without it you&#39;re going to have 401 error - anautorized)</p></li>
<li><p>id_token - it&#39;s JWT token, which contains information in it&#39;s body. The most important part is unique masterKey, which can be used for different usecases (for example, as a key for your encryption/decryption process). To learn more about id_token structure you may want to take a look at our <a href="https://developer.hushmesh.com/token-viewer">token viewer</a></p></li>
</ul>
<h2 id='how-to-parse-masterkey-from-id_token'>How to parse masterKey from id_token:</h2>
<blockquote>
<p>parse masterKey</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">idToken</span> <span class="o">=</span> <span class="s1">'your_id_token_here'</span>
<span class="kr">const</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">idToken</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">jwtObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="kr">const</span> <span class="nx">masterKey</span> <span class="o">=</span> <span class="nx">jwtObj</span><span class="p">.</span><span class="nx">masterKey</span>
</code></pre><h1 id='alpplication-example'>Alpplication example</h1>
<p>In this section we are going to explore simple application  <a href="https://hushsafe.com/">hushsafe.com</a> that demonstrates the unique security capabilities enabled by the mesh.</p>

<p>We are going to use meshin button and auth experience, getting user&#39;s data and to use storage API.</p>
<h2 id='application-stack'>Application stack</h2>
<p>Hushsafe is single page application, stack we are using:
* Vue.js framework
* Vue router as application router
* Vuex as state management
* axios to make API calls</p>
<h2 id='app-registration'>App registration</h2>
<p>First step for any mesh application should be app registration in <a href="http://developer.hushmesh.com/relying-party-registration">relying parties tool</a>. Meshin in the tool and you&#39;re going be able to create and manage your applications.</p>
<h2 id='meshin-button'>Meshin button</h2>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">Meshlib</span> <span class="nx">from</span> <span class="s1">'@/assets/js/meshlib-pkce'</span>
<span class="kr">import</span> <span class="nx">crypto</span> <span class="nx">from</span> <span class="s1">'@/services/crypto'</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">codeChallenge</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">generateChallengeData</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">meshApi</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meshlib</span><span class="p">({</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="s1">'9h2fhfUVuS9jZ8uVbhV3vC5AWX39IVUW'</span><span class="p">,</span>
  <span class="na">responseType</span><span class="p">:</span> <span class="s1">'code'</span><span class="p">,</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s1">'/callback'</span><span class="p">,</span>
  <span class="nx">codeChallenge</span><span class="p">,</span>
  <span class="na">codeChallengeMethod</span><span class="p">:</span> <span class="s1">'S256'</span><span class="p">,</span>
  <span class="na">isPopup</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">})</span>

<span class="c1">// Inside click handler</span>
<span class="nx">meshApi</span><span class="p">.</span><span class="nx">meshin</span><span class="p">()</span>
</code></pre>
<p>After successful app registration we can copy Meshin button code from our application page in <a href="https://developer.hushmesh.com/relying-party-registration">relying parties tool</a></p>

<p>You can find all information about meshin button in <a href="http://developer.hushmesh.com/#meshin">meshin section</a></p>

<p>On Hushsafe.com we are using exactly the approach from the meshin section</p>
<h2 id='callback-page'>Callback page</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">opener</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s1">'/auth'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s1">'/auth'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>On Hushsafe.com we&#39;re using approach with popup, because of that we need callback page which can close the popup and redirect to the app auth page (which responsible for the exchange of the code for tokens)</p>

<p>Callback page should be specified as <code>redirectUri</code>. Url going to have query string with exchange code which you should use to exchange code to the tokens.</p>

<p><code>https://hushsafe.com/auth?access_token=code=your_exchange_code</code></p>

<p>From this url we are grabbing code and providing it to auth page.</p>
<h2 id='auth-page'>Auth page</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$route</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">code</span>
  <span class="kr">const</span> <span class="nx">codeVerifier</span> <span class="o">=</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'code_verifier'</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'user/getTokens'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// success, at this point we have tokens</span>
      <span class="c1">// and can use any Mesh API</span>
      <span class="c1">// userinfo in this example</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'user/getUserData'</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// error</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre>
<p>At this point we already have code to exchange it to tokens, so the main goal of the page is to make api call to get tokens and depends on the results go to another route(on success) or show error message on error.</p>

<p>To learn more about token exchange see <a href="https://developer.hushmesh.com/#exchange-code-to-oauth-tokens">Exchange code to oauth tokens</a></p>
<h2 id='getting-user-39-s-info'>Getting user&#39;s info</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">'axios'</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">'@/store'</span>

<span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/userinfo'</span>
<span class="kr">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1">// here we're setting received token to axios header</span>
<span class="kr">const</span> <span class="nx">setHeaders</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/accessToken'</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">axiosConfig</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">accessToken</span><span class="p">}</span><span class="s2">`</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">getUserData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Fetching user data like name, email etc.</span>
  <span class="nx">setHeaders</span><span class="p">()</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">BASE_URL</span><span class="p">,</span> <span class="nx">axiosConfig</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">getUserData</span>
<span class="p">}</span>

</code></pre>
<p>If nesessary, at this point we can get meshid in user&#39;s info with <a href="http://developer.hushmesh.com/#user">userinfo</a> api. This step is optional and you may skip it if you don&#39;t need user&#39;s info but only would like to use storage api.</p>
<h2 id='encryption'>Encryption</h2>
<blockquote>
<p>Crypto.js example</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">encUTF8</span> <span class="nx">from</span> <span class="s1">'crypto-js/enc-utf8'</span>
<span class="kr">import</span> <span class="nx">AES</span> <span class="nx">from</span> <span class="s1">'crypto-js/aes'</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">'@/store'</span>

<span class="kr">const</span> <span class="nx">encrypt</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// To encrypt/decrypt values we are using user's master key</span>
  <span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/masterKey'</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">AES</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">decrypt</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/masterKey'</span><span class="p">]</span>
  <span class="k">return</span> <span class="nx">AES</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">secret</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="nx">encUTF8</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">encrypt</span><span class="p">,</span>
  <span class="nx">decrypt</span>
<span class="p">}</span>
</code></pre>
<p>We don&#39;t want to send unencrypted data, so we should prepare a solytion to encrypt/decrypt data. Here we&#39;re using crypto.js library and our masterkey as a secret.</p>
<h2 id='storage-api'>Storage API</h2>
<blockquote>
<p>Storage api usage</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">'axios'</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">'@/store'</span>

<span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/storage'</span>

<span class="kr">const</span> <span class="nx">setHeaders</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">axiosConfig</span> <span class="o">=</span> <span class="p">{</span> <span class="na">headers</span><span class="p">:</span> <span class="p">{}</span> <span class="p">}</span>
  <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getters</span><span class="p">[</span><span class="s1">'user/accessToken'</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">axiosConfig</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">Authorization</span><span class="p">:</span> <span class="s2">`Bearer </span><span class="p">${</span><span class="nx">accessToken</span><span class="p">}</span><span class="s2">`</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">axiosConfig</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">fetchData</span> <span class="o">=</span> <span class="nx">id</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// To fetch data you're going to need an object id you've created before</span>
  <span class="c1">// You can also get all object ids available for user</span>
  <span class="c1">// by GET request to BASE_URL</span>
  <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">setHeaders</span><span class="p">()</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">BASE_URL</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">storeData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// To store the data you have to provide object id</span>
  <span class="c1">// and data which can be any format including binary</span>
  <span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">setHeaders</span><span class="p">()</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'Content-Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'application/json'</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">BASE_URL</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">fetchData</span><span class="p">,</span>
  <span class="nx">storeData</span>
<span class="p">}</span>
</code></pre>
<p>Now we can use storage api to save and fetch data</p>
<h2 id='save-data'>Save data</h2>
<blockquote>
<p>Keycard example</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"D00g0sxZ"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Keycard Title"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"U2FsdGVkX19Sm+yIbQYNf1cetF14oA62KU97GCmFU3Y="</span><span class="p">,</span><span class="w">
  </span><span class="s2">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-12T15:33:00.909Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>To save data we should provide object id. In case of hushsafe we want to store user&#39;s keycards, so let&#39;s call it &#39;keycards&#39;.
Our full endpoint going to be
<code>https://api.hshm.sh/v0/storage/keycards</code></p>

<p>You free to decide what format do you want to use. In our case each keycard has four fields: id, title, data, createdAt.
As you can see, our data is encrypted with crypto.js</p>
<h2 id='fetch-and-delete-data'>Fetch and Delete data</h2>
<p>To fetch data back we&#39;re going to use the same endpoint but GET request, to delete - DELETE request
<code>https://api.hshm.sh/v0/storage/keycards</code></p>

<p><a href="http://developer.hushmesh.com/#storage">Storage api docs</a></p>
<h2 id='object-ids-available-to-user'>Object Ids available to user</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  GET https://api.hshm.sh/v0/storage
</code></pre>
<p>In case you want to get all object ids meshedin user has an access, you can do it by sending request to</p>

<p><code>GET api.hshm.sh/v0/storage</code></p>
<h1 id='storage-api'>Storage API</h1><h2 id='get-object-ids'>Get Object Ids</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  GET https://api.hshm.sh/v0/storage
</code></pre>
<p><code>GET api.hshm.sh/v0/storage</code></p>

<p>Lists object ids for the meshed in user</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"objectIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"id1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"id2"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='store-data'>Store data</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  POST https://api.hshm.sh/v0/storage/some_id
  body: <span class="o">{</span><span class="s2">"title"</span>: <span class="s2">"data"</span><span class="o">}</span>
</code></pre>
<p><code>POST api.hshm.sh/v0/storage/{object_id}</code></p>

<p>Store arbitrary data for the meshed in user</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='parameters'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>object_id</td>
<td>String</td>
<td>Yes</td>
<td>The id of the stored data</td>
</tr>
</tbody></table>
<h2 id='get-stored-data'>Get stored data</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  GET https://api.hshm.sh/v0/storage/some_id
</code></pre>
<p><code>GET api.hshm.sh/v0/storage/{object_id}</code></p>

<p>Fetch data that was stored for the meshed in user</p>

<blockquote>
<p>Return object</p>
</blockquote>

<p>The data in the same format user stored previously</p>
<h3 id='parameters-2'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>object_id</td>
<td>String</td>
<td>Yes</td>
<td>The id of the stored data</td>
</tr>
</tbody></table>
<h2 id='delete-stored-data'>Delete stored data</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  DELETE https://api.hshm.sh/v0/storage/some_id
</code></pre>
<p><code>DELETE api.hshm.sh/v0/storage/{object_id}</code></p>

<p>Delete data that was stored for the meshed in user.</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='parameters-3'>Parameters</h3>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>object_id</td>
<td>String</td>
<td>Yes</td>
<td>The id of the stored data</td>
</tr>
</tbody></table>
<h1 id='user-info'>User info</h1>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  https://api.hshm.sh/v0/userinfo
</code></pre>
<p><code>GET api.hshm.sh/v0/userinfo</code></p>

<p>Retrieves user info for the access token</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alice"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"Email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice@hushmesh.net"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre><h1 id='meshout'>Meshout</h1>
<p>To finish authorized access to the Mesh, you should use meshout API. It is a simple GET call to &#39;/logout&#39; endpoint. Please make sure to provide usual Bearer Authorization header, otherwise it is not going to work.</p>

<blockquote>
<p>Header example</p>
</blockquote>
<pre class="highlight plaintext"><code>axiosConfig.headers = {
  Authorization: `Bearer [YOUR_TOKEN]`
}
</code></pre><h2 id='meshout-api'>Meshout API</h2>
<blockquote>
<p>Example</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>  https://api.hshm.sh/v0/logout
</code></pre>
<p><code>GET api.hshm.sh/v0/logout</code></p>

<p>Finishes Mesh session</p>

<blockquote>
<p>Return object</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
   </span><span class="s2">"statusDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Success"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre><h1 id='browser-extension'>Browser extension</h1>
<p>If you&#39;re developing a browser extension most of the information related to web application going to be relevant. The main difference going to be meshin experience. We&#39;re going to cover all differences in this section - we&#39;re going to use Chrome browser as an example.</p>
<h2 id='meshin-browser-extension'>Meshin browser extension</h2>
<p>In browser extensions we cannot use the same callback flow as per web applications. Usually your browser extension will have url similar to <code>chrome-extension://npmgajiaihfjibkgojndemlehpalicjc/home.html</code> and we cannot open such url as a callback because of security restrictions.</p>

<p>Instead of the callback we should use browser&#39;s <a href="https://developer.chrome.com/apps/identity">identity API</a> and receive our tokens information in the response.</p>

<p>Let&#39;w walk through the code example:</p>

<ul>
<li><p>First we create codeChallenge and codeVerifier the same way as per web application - we&#39;re still going to need them</p></li>
<li><p>We&#39;re getting redirect url using identity.getRedirectURL() method</p></li>
<li><p>We&#39;re creating url for api call with our application parameters. Make sure to use your real application clientId here from relying party registration tool</p></li>
<li><p>Then we&#39;re launching auth flow using identity.launchWebAuthFlow() method</p></li>
<li><p>After successful meshin we&#39;re getting back code which we should exchange to tokens - this logic is exactly the same as for the web and you can find more details about it in <a href="https://developer.hushmesh.com/#oauth-tokens">Oauth tokens section</a></p></li>
</ul>

<blockquote>
<p>Identity API :</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
  <span class="kr">const</span> <span class="nx">getAuthUrl</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">'https://api.hshm.sh/v0/init'</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">responseType</span><span class="p">,</span> <span class="nx">clientId</span><span class="p">,</span> <span class="nx">redirectUri</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">options</span>
    <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">BASE_URL</span><span class="p">}</span><span class="s2">?&amp;response_type=</span><span class="p">${</span><span class="nx">responseType</span><span class="p">}</span><span class="s2">&amp;client_id=</span><span class="p">${</span><span class="nx">clientId</span><span class="p">}</span><span class="s2">&amp;redirect_uri=`</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">redirectUri</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">url</span>
  <span class="p">}</span>

  <span class="kr">const</span> <span class="nx">meshin</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">codeChallenge</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">generateChallengeData</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">redirectUri</span> <span class="o">=</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">identity</span><span class="p">.</span><span class="nx">getRedirectURL</span><span class="p">()</span>
      <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">getAuthUrl</span><span class="p">({</span>
        <span class="na">clientId</span><span class="p">:</span> <span class="s1">'YOUR_APP_CLIENT_ID'</span><span class="p">,</span>
        <span class="na">responseType</span><span class="p">:</span> <span class="s1">'code'</span><span class="p">,</span>
        <span class="nx">redirectUri</span><span class="p">,</span>
        <span class="nx">codeChallenge</span><span class="p">,</span>
        <span class="na">codeChallengeMethod</span><span class="p">:</span> <span class="s1">'S256'</span><span class="p">,</span>
      <span class="p">})</span>

      <span class="nx">chrome</span><span class="p">.</span><span class="nx">identity</span><span class="p">.</span><span class="nx">launchWebAuthFlow</span><span class="p">({</span>
        <span class="nx">url</span><span class="p">,</span>
        <span class="na">interactive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">},</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">getUrlParameter</span><span class="p">(</span><span class="s1">'code'</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span>

        <span class="c1">// From there logic is exactly the same as for web app</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">tokenApi</span><span class="p">.</span><span class="nx">getTokens</span><span class="p">({</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">codeVerifier</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">access_token</span>
            <span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id_token</span>
            <span class="kd">let</span> <span class="nx">masterKey</span> <span class="o">=</span> <span class="s1">''</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">jwt</span><span class="p">)</span> <span class="p">{</span>
              <span class="kr">const</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
              <span class="kr">const</span> <span class="nx">jwtObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
              <span class="nx">masterKey</span> <span class="o">=</span> <span class="nx">jwtObj</span><span class="p">.</span><span class="nx">masterKey</span>
            <span class="p">}</span>
            <span class="nx">resolve</span><span class="p">({</span> <span class="nx">accessToken</span><span class="p">,</span> <span class="nx">masterKey</span> <span class="p">})</span>
          <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
          <span class="p">})</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">reject</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre><h2 id='caveats'>Caveats</h2>
<p>To store tokens and masterKey it&#39;s better to use your extension background. If you&#39;re going to put them in the popup, they&#39;re going to be cleared every time user is closing popup.</p>
<h1 id='errors'>Errors</h1>
<p>The HTTP error codes returned:</p>

<table><thead>
<tr>
<th>Status code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Missing/Invalid fields in the request</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized, additional credentials needed</td>
</tr>
<tr>
<td>403</td>
<td>Permission Denied</td>
</tr>
<tr>
<td>404</td>
<td>Resource Not Found</td>
</tr>
<tr>
<td>406</td>
<td>Unhandled message type</td>
</tr>
<tr>
<td>409</td>
<td>Conflict</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
